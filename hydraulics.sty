%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% hydraulics.sty
%
% The symbols are based on ISO 1219
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%:File hydraulics.sty
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{hydraulics}[%
  2026/01/14 v0.0.1 Symbology to draw hydraulics circuits with TikZ
] 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%: Packages Loading

\RequirePackage{tikz}
	\usetikzlibrary{shapes}
	\usetikzlibrary{arrows.meta}
  \usetikzlibrary{shapes.geometric}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%: Definitions, Parameters and Commands

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%: Styles for Streams, Units and Signals
% Define a pump symbol
\tikzset{
  /tikz/fixed displacment pump/.pic = {
    \draw[thick] (0,0) circle (5mm);
    \draw[-{Triangle[scale=1mm]}] (0,0.4) -- (0,0.5);
    \draw[thick] (0,0.5) -- (0,0.9);
    \draw[thick] (0,-0.5) -- (0,-0.9);
    \draw[thick] (0.49,0.1) -- (1.1,0.1);
    \draw[thick] (0.49,-0.1) -- (1.1,-0.1);
    \draw[thick] (1.1,-0.3) -- (1.1,0.3);
    \coordinate (-in) at (0,-0.9);
    \coordinate (-out) at (0,0.9);
  },
  /tikz/variable displacment pump/.pic = {
    \draw[thick] (0,0) circle (5mm);
    \draw[-{Triangle[scale=1mm]}] (0,0.4) -- (0,0.5);
    \draw[thick] (0,0.5) -- (0,0.9);
    \draw[thick] (0,-0.5) -- (0,-0.9);
    \draw[thick] (0.49,0.1) -- (1.1,0.1);
    \draw[thick] (0.49,-0.1) -- (1.1,-0.1);
    \draw[-Latex, thick] (-0.6,-0.8) -- (0.7,0.9);
    \draw[-Latex, thick] (0.9,-0.4) to [bend left=45] (0.9,0.5);
    \coordinate (-in) at (0,-0.9);
    \coordinate (-out) at (0,0.9);
  },
}

% Define a valve symbol
\tikzset{
  valve/.pic = {
    \draw[thick] (0,0) -- ++(0,0.5cm) -- ++(0.5cm,0) -- ++(0,-0.5cm);
    \node at (0,-0.5cm) {#1};
  }
}

% Remember that you can not have a empty line
\tikzset{
  % Control Mechanisms 
  %% Mechanical Components
  %%% Rotating Shaft
  %%% Adjustible Stroke Limiter
  %%% Detent
  %%% Roller
  %%% Spring
  %% Fluidic
  %%% Pneumatic Pilot
  %%% Hydraulic Pilot
  %% Manual
  %%% General
  %%% Push button
  %%% Lever
  /tikz/lever/.pic={
    \draw[thick] (-1,0.4) -- (0,0.4);
    \draw[thick] (-0.8,0) -- (0,0);
    % y = -2x - 1.6
    \draw[thick] (-1.2,0.8) -- (-0.7,-0.2);
    \fill (-1.2,0.8) circle (0.6mm);
    \coordinate (-right) at (0,-0.3);
  },
  %%% Pedal
  /tikz/pedal/.pic={
    \draw[thick] (-0.8,0.4) -- (0,0.4);
    \draw[thick] (-1,0) -- (0,0);
    % y = 2x + 2
    \draw[thick] (-1.2,-0.4) -- (-0.7,0.6);
    % (-1)-(-0.7) = 0.3, 0.6 + 0.3/2 = 0.75,  deg(150) - deg(60) = deg(90)
    \draw[thick] (-0.7,0.6) -- (-1,0.75);
    \coordinate (-right) at (0,-0.3);
  },
  %% Electrical
  %%% Solenoid
  /tikz/solenoid/.pic={
    \draw[thick] (0,0.4) -- (-0.8,0.4) -- (-0.8,0) -- (0,0);
    \draw[thick] (-0.5,0) -- (-0.3,0.4);
    \coordinate (-right) at (0,-0.3);
  },
  %%% Proportional Solenoid
  %%% Proportional Solenoid With Feedback
  % Directional valve
  /tikz/two port two position normaly closed/.pic={
    \draw[thick] (0,0) rectangle (2,2);
    \draw[-latex, very thick] (1,0) -- (1,2);
    \draw[thick] (2,0) rectangle (4,2);
    \draw[very thick] (3,-0.4) -- (3,0.5);
    \draw[very thick] (2.8,0.5) -- (3.2,0.5);
    \draw[very thick] (3,2.4) -- (3,1.5);
    \draw[very thick] (2.8,1.5) -- (3.2,1.5);
    \coordinate (-left) at (0,0);
    \coordinate (-controlmechanism) at (0,0.3);
    \coordinate (-p) at (3,-0.4);
    \coordinate (-t) at (3,-0.4);
    \coordinate (-a) at (3,2.4);
    \coordinate (-b) at (3,2.4);
  },
  /tikz/two port two position normaly open/.pic={
    \draw[thick] (0,0) rectangle (2,2);
    \draw[very thick] (1,0) -- (1,0.5);
    \draw[very thick] (0.8,0.5) -- (1.2,0.5);
    \draw[very thick] (1,2) -- (1,1.5);
    \draw[very thick] (0.8,1.5) -- (1.2,1.5);
    \draw[thick] (2,0) rectangle (4,2);
    \draw[-latex, very thick] (3,0) -- (3,2);
    \draw[very thick] (3,-0.4) -- (3,2.4);
    \coordinate (-left) at (0,0);
    \coordinate (-controlmechanism) at (0,0.3);
    \coordinate (-p) at (3,-0.4);
    \coordinate (-t) at (3,-0.4);
    \coordinate (-a) at (3,2.4);
    \coordinate (-b) at (3,2.4);
  },
  /tikz/three port two position normaly open/.pic={
    \draw[thick] (0,0) rectangle (2,2);
    \draw[very thick] (0.5,0) -- (0.5,0.5);
    \draw[very thick] (0.3,0.5) -- (0.7,0.5);
    \draw[-latex, very thick] (0.5,2) -- (1.5,0);
    \draw[thick] (2,0) rectangle (4,2);
    \draw[-latex, very thick] (2.5,0) -- (2.5,2);
    \draw[very thick] (2.5,-0.4) -- (2.5,2.4);
    \draw[very thick] (3.5,-0.4) -- (3.5,0.5);
    \draw[very thick] (3.3,0.5) -- (3.7,0.5);
    \coordinate (-left) at (0,0);
    \coordinate (-controlmechanism) at (0,0.3);
    \coordinate (-p) at (2.5,-0.4);
    \coordinate (-t) at (3.5,-0.4);
    \coordinate (-a) at (2.5,2.4);
    \coordinate (-b) at (2.5,2.4);
  },
  /tikz/three port two position normaly closed/.pic={
    \draw[thick] (0,0) rectangle (2,2);
    \draw[-latex, very thick] (0.5,0) -- (0.5,2);
    \draw[very thick] (1.5,0) -- (1.5,0.5);
    \draw[very thick] (1.3,0.5) -- (1.7,0.5);
    \draw[thick] (2,0) rectangle (4,2);
    \draw[very thick] (2.5,-0.4) -- (2.5,0.5);
    \draw[very thick] (2.3,0.5) -- (2.7,0.5);
    \draw[-latex, very thick] (2.5,2) -- (3.5,0);
    \draw[very thick] (3.5,-0.4) -- (3.5,0);
    \draw[very thick] (2.5,2.4) -- (2.5,2);
    \coordinate (-left) at (0,0);
    \coordinate (-controlmechanism) at (0,0.3);
    \coordinate (-p) at (2.5,-0.4);
    \coordinate (-t) at (3.5,-0.4);
    \coordinate (-a) at (2.5,2.4);
    \coordinate (-b) at (2.5,2.4);
  },
  /tikz/four port two position normaly open in centre position/.pic={
    \draw[thick] (0,0) rectangle (2,2);
    \draw[-latex, very thick] (0.5,2) -- (1.5,0);
    \draw[-latex, very thick] (0.5,0) -- (1.5,2);
    \draw[thick] (2,0) rectangle (4,2);
    \draw[-latex, very thick] (2.5,0) -- (2.5,2);
    \draw[very thick] (2.5,-0.4) -- (2.5,2.4);
    \draw[-latex, very thick] (3.5,0) -- (3.5,2);
    \draw[very thick] (3.5,-0.4) -- (3.5,2.4);
    \coordinate (-left) at (0,0);
    \coordinate (-controlmechanism) at (0,0.3);
    \coordinate (-p) at (2.5,-0.4);
    \coordinate (-t) at (3.5,-0.4);
    \coordinate (-a) at (2.5,2.4);
    \coordinate (-b) at (3.5,2.4);
  },
  /tikz/four port three position closed centre/.pic={
    \draw[thick] (0,0) rectangle (2,2);
    \draw[-latex, very thick] (0.5,2) -- (1.5,0);
    \draw[-latex, very thick] (0.5,0) -- (1.5,2);
    \draw[thick] (2,0) rectangle (4,2);
    \draw[very thick] (2.5,-0.4) -- (2.5,0.5);
    \draw[very thick] (2.3,0.5) -- (2.7,0.5);
    \draw[very thick] (3.5,-0.4) -- (3.5,0.5);
    \draw[very thick] (3.3,0.5) -- (3.7,0.5);
    \draw[very thick] (2.5,2.4) -- (2.5,1.5);
    \draw[very thick] (2.3,1.5) -- (2.7,1.5);
    \draw[very thick] (3.5,2.4) -- (3.5,1.5);
    \draw[very thick] (3.3,1.5) -- (3.7,1.5);
    \draw[thick] (4,0) rectangle (6,2);
    \draw[-latex, very thick] (4.5,0) -- (4.5,2);
    \draw[-latex, very thick] (5.5,0) -- (5.5,2);
    \coordinate (-left) at (0,0);
    \coordinate (-controlmechanism) at (0,0.3);
    \coordinate (-p) at (2.5,-0.4);
    \coordinate (-t) at (3.5,-0.4);
    \coordinate (-a) at (2.5,2.4);
    \coordinate (-b) at (3.5,2.4);
  },
  /tikz/four port three position a and b to t p blocked in centre position/.pic={
    \draw[thick] (0,0) rectangle (2,2);
    \draw[-latex, very thick] (0.5,2) -- (1.5,0);
    \draw[-latex, very thick] (0.5,0) -- (1.5,2);
    \draw[thick] (2,0) rectangle (4,2);
    \draw[very thick] (2.5,-0.4) -- (2.5,0.5);
    \draw[very thick] (2.3,0.5) -- (2.7,0.5);
    \draw[very thick] (2.5,2.4) -- (2.5,1) -- (3.5,1);
    \draw[very thick] (3.5,2.4) -- (3.5,-0.4);
    \fill (3.5,1) circle (1.5mm);
    \draw[thick] (4,0) rectangle (6,2);
    \draw[-latex, very thick] (4.5,0) -- (4.5,2);
    \draw[-latex, very thick] (5.5,0) -- (5.5,2);
    \coordinate (-left) at (0,0);
    \coordinate (-controlmechanism) at (0,0.3);
    \coordinate (-p) at (2.5,-0.4);
    \coordinate (-t) at (3.5,-0.4);
    \coordinate (-a) at (2.5,2.4);
    \coordinate (-b) at (3.5,2.4);
  },
  /tikz/infinite positioning/.pic={
    \draw[thick] (0,2.15) -- (6,2.15);
    \draw[thick] (0,-0.15) -- (6,-0.15);
    \draw[thick] (0,0) rectangle (2,2);
    \draw[-latex, very thick] (0.5,2) -- (1.5,0);
    \draw[-latex, very thick] (0.5,0) -- (1.5,2);
    \draw[thick] (2,0) rectangle (4,2);
    \draw[very thick] (2.5,-0.4) -- (2.5,0.5);
    \draw[very thick] (2.3,0.5) -- (2.7,0.5);
    \draw[very thick] (3.5,-0.4) -- (3.5,0.5);
    \draw[very thick] (3.3,0.5) -- (3.7,0.5);
    \draw[very thick] (2.5,2.4) -- (2.5,1.5);
    \draw[very thick] (2.3,1.5) -- (2.7,1.5);
    \draw[very thick] (3.5,2.4) -- (3.5,1.5);
    \draw[very thick] (3.3,1.5) -- (3.7,1.5);
    \draw[thick] (4,0) rectangle (6,2);
    \draw[-latex, very thick] (4.5,0) -- (4.5,2);
    \draw[-latex, very thick] (5.5,0) -- (5.5,2);
    \coordinate (-left) at (0,0);
    \coordinate (-controlmechanism) at (0,0.3);
    \coordinate (-p) at (2.5,-0.4);
    \coordinate (-t) at (3.5,-0.4);
    \coordinate (-a) at (2.5,2.4);
    \coordinate (-b) at (3.5,2.4);
  },
  % Directional Control Valves (DCV)
  /tikz/dcv/.pic={
    \tikzset{dcv/.cd, #1}
    \edef\controlmechanism{\pgfkeysvalueof{/tikz/dcv/control mechanism}}
    \edef\directionalvalve{\pgfkeysvalueof{/tikz/dcv/directional valve}}
    \edef\picscale{\pgfkeysvalueof{/tikz/dcv/scale}}
    % Validate Control Mechanism
    \unless\ifnum\pdfstrcmp{\controlmechanism}{lever}=0\relax
    \unless\ifnum\pdfstrcmp{\controlmechanism}{pedal}=0\relax
    \unless\ifnum\pdfstrcmp{\controlmechanism}{solenoid}=0\relax
      \PackageError{TikZ}{Invalid Control Mechanism: '\controlmechanism'. Must be 'lever', 'pedal, or 'solenoid'}{}
    \fi\fi\fi
    % TODO Validate Directional Valve
    \pic[scale=\picscale] (dv) at (0, 0) {\directionalvalve};
    \pic[scale=\picscale] (cm1) at (dv-controlmechanism) {\controlmechanism};
    \coordinate (-p) at (dv-p);
    \coordinate (-t) at (dv-t);
    \coordinate (-a) at (dv-a);
    \coordinate (-b) at (dv-b);
  },
  /tikz/dcv/control mechanism/.initial=lever,
  /tikz/dcv/directional valve/.initial=two port two position normaly closed,
  /tikz/dcv/scale/.initial=1,
}
